<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="assets/icon.png">
    <title>C# Retro Arcade Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            --pixel-bg: #0a0118;
            --pixel-header: rgba(15, 0, 30, 0.95);
            --pixel-accent: #f2ea02; 
            --pixel-success: #00ff41; 
            --pixel-blue: #00d2ff;   
            --pixel-purple: #bd00ff;
            --pixel-border: #ffffff;
            --pixel-mario-red: #ff0000;
        }

        body {
            font-family: 'Press Start 2P', cursive;
            background-color: var(--pixel-bg);
            color: #ffffff;
            image-rendering: pixelated;
            font-size: 10px;
            overflow-x: hidden;
            min-height: 100vh;
            cursor: auto;
        }

        /* --- MATRIX FOLLOWER --- */
        #pointerFollower {
            position: fixed;
            top: 0; left: 0;
            pointer-events: none;
            z-index: 9999;
            transform: translate(-100%, -100%);
            display: flex;
            align-items: center;
            gap: 12px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .follower-badge {
            background: rgba(0, 255, 65, 0.15);
            border: 1px solid var(--pixel-success);
            padding: 6px 12px;
            border-radius: 4px;
            backdrop-filter: blur(4px);
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .follower-dot {
            width: 6px; height: 6px;
            background: var(--pixel-success);
            border-radius: 50%;
            box-shadow: 0 0 8px var(--pixel-success);
            animation: pulse-green 1.5s infinite;
        }

        @keyframes pulse-green {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.5; }
        }

        /* --- BARRAS DE PROGRESO 8-BIT --- */
        .pixel-bar-container {
            width: 100%; height: 16px;
            background: #222; border: 2px solid #555;
            position: relative; margin-top: 4px;
            box-shadow: inset 2px 2px 0 #000;
        }
        .pixel-bar-fill {
            height: 100%;
            background: repeating-linear-gradient(90deg, var(--bar-color), var(--bar-color) 12px, #000 12px, #000 14px);
        }

        /* --- FONDO DINàMIC --- */
        .background-container {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%; z-index: -2;
            background: linear-gradient(to bottom, #000000 0%, #0a0118 50%, #240046 100%);
            perspective: 800px; overflow: hidden;
        }

        .retro-grid {
            position: absolute; width: 200%; height: 200%; bottom: -50%; left: -50%;
            background-image: linear-gradient(rgba(189, 0, 255, 0.05) 1px, transparent 1px),
                              linear-gradient(90deg, rgba(189, 0, 255, 0.05) 1px, transparent 1px);
            background-size: 50px 50px; transform: rotateX(60deg);
            animation: gridScroll 10s linear infinite;
        }

        @keyframes gridScroll {
            0% { transform: rotateX(60deg) translateY(0); }
            100% { transform: rotateX(60deg) translateY(50px); }
        }

        #stars { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        @keyframes animStar { from { transform: translateY(0px); } to { transform: translateY(-2000px); } }

        /* --- 3D CARD STRUCTURE --- */
        .card-container { 
            perspective: 1000px; 
            height: 100%; 
            position: relative; 
            padding: 15px;
        }
        
        .card-wrapper {
            position: relative;
            border-radius: 20px;
            transform-style: preserve-3d;
            transition: transform 0.1s ease-out;
            height: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .course-card {
            position: relative;
            z-index: 1;
            background: #1F2121;
            border-radius: 18px;
            width: 100%;
            height: 100%;
            padding: 16px;
            display: flex;
            flex-direction: column;
            transition: background 0.4s ease;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.8);
            transform-style: preserve-3d;
        }

        /* --- EFECTO VERDE MATRIX EN IMáGENES --- */
        .course-card img {
            filter: brightness(0.6) contrast(1.4) sepia(1) hue-rotate(80deg) saturate(3) !important;
            transition: all 0.4s ease-in-out !important;
        }

        .card-container:hover .course-card { background: #252727; }
        
        .card-container:hover .course-card img {
            filter: brightness(1) contrast(1.1) sepia(0) hue-rotate(0deg) saturate(1.2) !important;
        }

        .float-layer-high { transform: translateZ(80px); }
        .float-layer-mid { transform: translateZ(40px); }
        .float-layer-low { transform: translateZ(20px); }

        .mouse-overlay { 
            position: absolute; 
            inset: 0; 
            z-index: 50; 
            cursor: none;
        }

        /* --- GLITCH --- */
        .glitch-active:hover .glitch-target {
            animation: glitch-text 0.3s cubic-bezier(.25,.46,.45,.94) both infinite;
            color: #fff;
            text-shadow: 2px 0 #ff00c1, -2px 0 #00fff9;
        }

        @keyframes glitch-text {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }

        /* --- PAC-MAN YELLOW --- */
        @keyframes chomp {
            0% { clip-path: polygon(100% 50%, 100% 0, 0 0, 0 100%, 100% 100%); }
            50% { clip-path: polygon(50% 50%, 100% 20%, 100% 0, 0 0, 0 100%, 100% 100%, 100% 80%); }
            100% { clip-path: polygon(100% 50%, 100% 0, 0 0, 0 100%, 100% 100%); }
        }

        .pacman-icon {
            width: 22px; height: 22px; 
            background: var(--pixel-accent); 
            border-radius: 50%;
            animation: chomp 0.3s ease-in-out infinite; 
            flex-shrink: 0;
            box-shadow: 0 0 10px rgba(242, 234, 2, 0.4);
        }

        .module-header-info {
            display: none; background: rgba(10, 1, 24, 0.95); border: 4px solid var(--pixel-border);
            padding: 30px; margin-bottom: 40px; box-shadow: 10px 10px 0px #000;
        }

        .ra-item {
            margin-bottom: 10px; font-size: 8px; color: #bbb; padding: 10px;
            border-left: 4px solid var(--pixel-success); background: rgba(0, 255, 65, 0.05);
            transition: transform 0.3s; line-height: 1.6;
        }
        .ra-item:hover { transform: translateX(10px); background: rgba(0, 255, 65, 0.1); }
        .ra-item b { color: var(--pixel-success); margin-right: 5px; }

        .download-btn {
            position: absolute; top: 10px; right: 10px; z-index: 150;
            background: rgba(0,0,0,0.7); border: 2px solid white; color: white;
            padding: 5px; border-radius: 4px; font-size: 10px; cursor: pointer;
            transition: all 0.2s; display: flex; align-items: center; justify-content: center;
        }
        .download-btn:hover { background: var(--pixel-accent); color: black; border-color: black; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

    <div id="pointerFollower">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-green-400 drop-shadow-[0_0_8px_#00ff41]">
            <path d="M5 19L19 5M19 5H10M19 5V14" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <div class="follower-badge">
            <div class="follower-dot"></div>
            <span id="matrixText" class="text-[8px] uppercase tracking-widest font-bold">Init mission</span>
        </div>
    </div>

    <div class="background-container">
        <div class="retro-grid"></div>
        <div id="stars"></div>
    </div>

    <nav class="sticky top-0 z-[500] p-4 bg-black/90 border-b border-gray-800 backdrop-blur-md">
        <div class="max-w-[1400px] mx-auto flex items-center justify-between gap-6">
            <div class="text-xl text-yellow-400 font-bold tracking-tighter shrink-0 cursor-pointer" onclick="location.reload()">C# Retro Arcade Platform</div>
            
             <div class="flex items-center gap-4 cursor-pointer shrink-0" onclick="toggleProfileModal()">
                <div id="nav-mario-icon"
                    class="animate-pulse w-14 h-14 border-4 border-gray-700 bg-black flex items-center justify-center hover:bg-purple-500 transition-all p-1 shadow-[4px_4px_0_#000]">
                    <svg viewBox="0 0 16 16" width="100%" height="100%" xmlns="http://www.w3.org/2000/svg"
                        shape-rendering="crispEdges">
                        <path d="M5 1h6v1H5V1zM4 2h9v1H4V2z" fill="#f00" />
                        <path d="M4 3h5v1H4V3zM3 4h2v1H3V4zM3 5h1v1H3V5zM7 5h1v1H7V5zM3 6h1v1H3V6z" fill="#840" />
                        <path d="M9 3h3v1H9V3z" fill="#840" />
                        <path d="M5 4h8v1H5V4z" fill="#fca" />
                        <path d="M4 5h8v2H4V5z" fill="#fca" />
                        <path d="M4 7h6v1H4V7z" fill="#fca" />
                        <path d="M9 4h1v2H9V4z" fill="#000" />
                        <path d="M10 6h3v1h-3V6z" fill="#840" />
                        <path d="M9 7h1v1H9V7z" fill="#840" />
                        <path d="M4 8h8v1H4V8z" fill="#f00" />
                        <path d="M3 9h10v1H3V9zM2 10h12v1H2v-1z" fill="#f00" />
                        <path d="M4 9h2v4H4V9z" fill="#00f" />
                        <path d="M10 9h2v4h-2V9z" fill="#00f" />
                        <path d="M6 11h4v1H6v-1zM5 13h6v1H5v-1z" fill="#00f" />
                        <path d="M5 10h1v1H5v-1zM10 10h1v1h-1v-1z" fill="#ff0" />
                        <path d="M3 14h3v1H3v-1zM10 14h3v1h-3v-1z" fill="#840" />
                    </svg>
                </div>
            </div>
        </div>
    </nav>

    <!-- BARRA DE FILTROS ACTUALIZADA -->
    <div class="bg-black/80 p-3 border-b border-gray-800 backdrop-blur-sm relative z-20 overflow-x-auto no-scrollbar">
        <div class="max-w-[1400px] mx-auto flex gap-4 min-w-max">
            <button onclick="setModuleFilter('ALL')" id="mod-all" class="text-[8px] px-4 py-2 bg-yellow-400 text-black font-bold border-b-4 border-r-4 border-yellow-700 transition-all">ALL_MISSIONS</button>
            <button onclick="setModuleFilter('M0485')" id="mod-M0485" class="text-[8px] px-4 py-2 bg-[#1a0133] text-white border-2 border-purple-900 transition-all">M0485_PROG</button>
            <button onclick="setModuleFilter('M0487')" id="mod-M0487" class="text-[8px] px-4 py-2 bg-[#1a0133] text-white border-2 border-purple-900 transition-all">M0487_ENTORNS</button>
        </div>
    </div>

    <main class="max-w-[1400px] mx-auto mt-12 px-6 relative z-10 pb-20">
        <div id="moduleInfoContainer">
            <div id="info-M0485" class="module-header-info border-blue-500">
                <h2 class="text-2xl text-blue-400 mb-6 uppercase tracking-tighter font-bold">M0485. PROGRAMACI_CORE</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="ra-list-M0485"></div>
            </div>
            <div id="info-M0487" class="module-header-info border-purple-500">
                <h2 class="text-2xl text-purple-400 mb-6 uppercase tracking-tighter font-bold">M0487. ENTORNS_DEV_SYSTEMS</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="ra-list-M0487"></div>
            </div>
        </div>
        <div class="mb-12 border-l-8 border-yellow-400 pl-6">
            <h2 id="missionsDatabaseTitle" class="text-3xl uppercase tracking-tighter mb-2 text-white font-bold min-h-[1.5em]"></h2>
            <p id="searchStatus" class="text-[8px] text-gray-500 uppercase tracking-widest font-bold">Status: Secure / Source: DAMV-Docs</p>
        </div>
        <div id="syllabusContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-12"></div>
    </main>

    <!-- CHARACTER SHEET -->
    <div id="profileModal" onclick="playCoin()" class="fixed inset-0 bg-black/95 z-[3000] hidden items-center justify-center p-6"
        >
        <div class="bg-[#111] border-4 border-white p-8 max-w-2xl w-full shadow-[15px_15px_0px_rgba(0,0,0,0.8)] border-double">
            <div class="flex items-start gap-8 mb-8 border-b-4 border-white/20 pb-6">
                <div id="mario-avatar-trigger" 
                onclick="playCoin()"
                    class="w-32 h-32 bg-black border-4 border-blue-500 flex items-center justify-center p-2 shadow-[6px_6px_0px_#f00] cursor-pointer hover:scale-105 transition-transform">
                    <svg viewBox="0 0 16 16" width="100%" height="100%" xmlns="http://www.w3.org/2000/svg"
                        shape-rendering="crispEdges">
                        <path d="M5 1h6v1H5V1zM4 2h9v1H4V2z" fill="#f00" />
                        <path d="M4 3h5v1H4V3zM3 4h2v1H3V4zM3 5h1v1H3V5zM7 5h1v1H7V5zM3 6h1v1H3V6z" fill="#840" />
                        <path d="M9 3h3v1H9V3z" fill="#840" />
                        <path d="M5 4h8v1H5V4z" fill="#fca" />
                        <path d="M4 5h8v2H4V5z" fill="#fca" />
                        <path d="M4 7h6v1H4V7z" fill="#fca" />
                        <path d="M9 4h1v2H9V4z" fill="#000" />
                        <path d="M10 6h3v1h-3V6z" fill="#840" />
                        <path d="M9 7h1v1H9V7z" fill="#840" />
                        <path d="M4 8h8v1H4V8z" fill="#f00" />
                        <path d="M3 9h10v1H3V9zM2 10h12v1H2v-1z" fill="#f00" />
                        <path d="M4 9h2v4H4V9z" fill="#00f" />
                        <path d="M10 9h2v4h-2V9z" fill="#00f" />
                        <path d="M6 11h4v1H6v-1z" fill="#00f" />
                        <path d="M5 10h1v1H5v-1zM10 10h1v1h-1v-1z" fill="#ff0" />
                        <path d="M3 14h3v1H3v-1zM10 14h3v1h-3v-1z" fill="#840" />
                    </svg>
                </div>
                <div class="flex-grow">
                    <div class="flex justify-between items-center mb-2">
                        <span class="bg-red-900 text-red-400 px-3 py-1 text-[8px] border border-red-500 font-bold uppercase">Super_Creator</span>
                        <span class="text-white text-[8px]">v2.3</span>
                    </div>
                    <h2 class="text-white text-xl uppercase font-bold tracking-tighter">Daniel Moreno</h2>
                    <p class="text-gray-400 text-[8px] uppercase leading-loose mt-2">Apasionat dels 8-bits i professor de CF.</p>
                </div>
            </div>
            
            <div class="flex flex-col gap-8 mb-8">
                <div>
                    <h3 class="text-yellow-400 text-[8px] mb-4 uppercase underline">System Levels:</h3>
                    <div class="mb-3">
                        <div class="flex justify-between items-baseline text-[7px] uppercase mb-1">
                            <div class="flex gap-2 items-baseline">
                                <span class="text-[7px]">MANA - </span>
                                <span class="text-gray-400 text-[6px]">Nivell de cafe茂na en sang</span>
                            </div>
                            <span class="text-blue-400">95%</span>
                        </div>
                        <div class="pixel-bar-container">
                            <div class="pixel-bar-fill" style="width: 95%; --bar-color: #00d2ff;"></div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="flex justify-between items-baseline text-[7px] uppercase mb-1">
                            <div class="flex gap-2 items-baseline">
                                <span class="text-[7px]">LUCK - </span>
                                <span class="text-gray-400 text-[6px]">Probabilitat que el codi compili a la primera</span>
                            </div>
                            <span class="text-blue-400">73%</span>
                        </div>
                        <div class="pixel-bar-container">
                            <div class="pixel-bar-fill" style="width: 73%; --bar-color: #ef0eeb;"></div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="flex justify-between items-baseline text-[7px] uppercase mb-1">
                            <div class="flex gap-2 items-baseline">
                                <span class="text-[7px]">STAMINA - </span>
                                <span class="text-gray-400 text-[6px]">Paci猫ncia davant un problema</span>
                            </div>
                            <span class="text-blue-400">98%</span>
                        </div>
                        <div class="pixel-bar-container">
                            <div class="pixel-bar-fill" style="width: 98%; --bar-color: #10ea38;"></div>
                        </div>
                    </div>
                </div>

                <div>
                    <h3 class="text-yellow-400 text-[8px] mb-4 uppercase underline">Special Abilities:</h3>
                    <div class="mb-3">
                        <div class="flex justify-between items-baseline text-[7px] uppercase mb-1">
                            <div class="flex gap-2 items-baseline">
                                <span class="text-[7px]">DEBUG TELEPATHY - </span>
                                <span class="text-gray-400 text-[6px]">Capacitat de detectar l'error al codi de l'alumne sense mirar</span>
                            </div>
                            <span class="text-blue-400">82%</span>
                        </div>
                        <div class="pixel-bar-container">
                            <div class="pixel-bar-fill" style="width: 82%; --bar-color: #e5f012;"></div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="flex justify-between items-baseline text-[7px] uppercase mb-1">
                            <div class="flex gap-2 items-baseline">
                                <span class="text-[7px]">KNOWLEDGE TRANSFER - </span>
                                <span class="text-gray-400 text-[6px]">Ritual de canalitzaci贸 de dades des del meu cervell al dels alumnes</span>
                            </div>
                            <span class="text-blue-400">67%</span>
                        </div>
                        <div class="pixel-bar-container">
                            <div class="pixel-bar-fill" style="width: 67%; --bar-color: #f35607;"></div>
                        </div>
                    </div>
                </div>

                <div class="bg-black/40 p-4 border border-gray-700">
                    <h3 class="text-yellow-400 text-[8px] mb-3 uppercase underline">Missi贸 Log:</h3>
                    <p class="text-gray-400 text-[7px] leading-loose uppercase">
                        <span class="text-white">"It's-a me, the Teacher!"</span>
                    </p>
                </div>
            </div>

            <button onclick="toggleProfileModal()"
                class="w-full py-4 bg-white text-black font-bold text-[8px] uppercase border-b-8 border-r-8 border-gray-400 hover:bg-red-600 active:translate-y-2 transition-all">RESUME_SYSTEM</button>
        </div>
    </div>

    <!-- MISSION MODAL -->
    <div id="missionModal" class="fixed inset-0 bg-black/95 z-[3000] hidden items-center justify-center p-6">
        <div class="bg-[#1a0133] border-8 border-double border-yellow-400 p-8 max-w-md w-full text-center shadow-[15px_15px_0px_#000]">
            <div class="text-yellow-400 text-2xl mb-4 font-bold tracking-tighter uppercase">Mission Start!</div>
            <p id="missionName" class="text-white text-[11px] uppercase mb-4 leading-loose bg-black p-4 border border-purple-500"></p>
            <p id="missionDescLong" class="text-gray-400 text-[8px] mb-8 leading-relaxed uppercase tracking-tight"></p>
            <button onclick="closeMission()" class="w-full py-4 bg-white text-black font-bold text-[10px] uppercase border-b-8 border-r-8 border-gray-400 hover:bg-green-400 transition-all">START_PROTOCOLS</button>
        </div>
    </div>

 <audio id="bg-music" loop preload="auto">
        <source src="audio/song.mp3" type="audio/mp4">
    </audio>

    <audio id="coin-sound" preload="auto">
    <source src="audio/coin.mp3" type="audio/mpeg">
</audio>

    <button id="music-toggle"
        class="fixed bottom-4 right-4 w-12 h-12 border-4 border-gray-700 bg-black text-white flex items-center justify-center hover:bg-purple-500 shadow-[4px_4px_0_#000] z-50">
        <span id="music-icon"></span>
    </button>
<script>
// 2. DEFINIM L'UDIO FORA PERQU ESTIGUI SEMPRE LLEST
    const coinSfx = document.getElementById('coin-sound');
    
    // Forcem la precrrega
    coinSfx.load();

    function playCoin() {
        const avatar = document.getElementById('mario-avatar-trigger');

        // REPRODUCCI FORADA
        if (coinSfx) {
            coinSfx.pause();        // Aturem qualsevol so previ
            coinSfx.currentTime = 0; // Tornem al principi
            
            // Usem un timeout per donar un micro-respir al navegador
            setTimeout(() => {
                coinSfx.play().catch(e => console.error("Error en el play:", e));
            }, 10);
        }

        // ANIMACI (Aix貌 ja et funciona, per貌 ho mantenim)
        if (avatar) {
            avatar.classList.add('animate-bounce');
            setTimeout(() => avatar.classList.remove('animate-bounce'), 500);
        }
    }
        // --- LGICA DE AUDIO ---
        const music = document.getElementById('bg-music');
        const toggleBtn = document.getElementById('music-toggle');
        const icon = document.getElementById('music-icon');
        const marioAvatar = document.getElementById('mario-avatar-trigger');

        music.volume = 0.3;

        // Funci贸n para saltar a punto aleatorio
        function setRandomStartTime() {
            if (music.duration) {
                const randomTime = Math.floor(Math.random() * music.duration);
                music.currentTime = randomTime;
            }
        }

        music.addEventListener('loadedmetadata', setRandomStartTime);

        toggleBtn.addEventListener('click', () => {
            if (music.paused) {
                // Si es la primera vez que se da al play y no se ha cargado el tiempo aleatorio
                if (music.currentTime === 0) setRandomStartTime();
                music.play();
                icon.innerText = '';
                toggleBtn.classList.add('animate-pulse');
            } else {
                music.pause();
                icon.innerText = '';
                toggleBtn.classList.remove('animate-pulse');
            }
        });
		
		

</script>

    <script>
	
	
	
	
	
        const apiKey = "";
        let currentSearch = '';
        let currentModule = 'ALL';

        function animateEncryptedText(elementId, targetText, revealDelay = 50) {
            const el = document.getElementById(elementId);
            if (!el) return;
            const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%&*";
            let revealedIndex = 0;
            if (el.dataset.intervalId) clearInterval(el.dataset.intervalId);
            const interval = setInterval(() => {
                let display = "";
                for (let i = 0; i < targetText.length; i++) {
                    if (i < revealedIndex) display += `<span class="text-white font-bold">${targetText[i]}</span>`;
                    else display += `<span class="text-neutral-600">${chars[Math.floor(Math.random() * chars.length)]}</span>`;
                }
                el.innerHTML = display;
                if (revealedIndex >= targetText.length) clearInterval(interval);
                revealedIndex++;
            }, revealDelay);
            el.dataset.intervalId = interval;
        }

        const raData = {
            M0485: ["RA1. Estructura de programes.", "RA2. Fonaments POO.", "RA3. Estructures de control.", "RA4. Programes en classes.", "RA5. Entrada i sortida.", "RA6. Col路leccions.", "RA7. POO Avan莽ada.", "RA8. Persist猫ncia.", "RA9. Gesti贸 DB."],
            M0487: ["RA1. Elements desenvolupament.", "RA2. Entorns IDE.", "RA3. Disseny de proves.", "RA4. Optimitzaci贸.", "RA5. Diagrames classes.", "RA6. Diagrames comportament."]
        };

        const syllabus = [
            { id: 1, title: "Algoritmia i Flowcharts", module: "M0485", ra: ["RA1", "RA3"], desc: "Disseny de l貌gica base mitjan莽ant diagrames estructurats.", img: "assets/m1.png", url: "algoritmia-flowcharts.html" },
            { id: 2, title: "Git i Control de Versions", module: "M0487", ra: ["RA1"], desc: "Gesti贸 professional del codi font y branques.", img: "assets/m2.png", url: "git-control-de-versions.html" },
            { id: 3, title: "Entorns IDE i Debugging", module: "M0487", ra: ["RA2"], desc: "Domini de Visual Studio i eines de depuraci贸.", img: "assets/m3.png", url: "entorns-ide-debugging.html" },
            { id: 4, title: "Modularitat i M猫todes", module: "M0485", ra: ["RA2", "RA3"], desc: "Fragmentaci贸 de problemes en unitats funcionals.", img: "assets/m4.png", url: "modularitat-metodes.html" },
            { id: 5, title: "Refactoring i Optimitzaci贸", module: "M0487", ra: ["RA4"], desc: "Millora del rendiment del codi font existent.", img: "assets/m5.png", url: "refactoring-optimitzacio.html" },
            { id: 6, title: "Disseny de Classes POO", module: "M0485", ra: ["RA4"], desc: "Objectes, classes, her猫ncia i polimorfisme en C#.", img: "assets/m6.png", url: "disseny-classes-poo.html" },
            { id: 7, title: "Modelatge UML", module: "M0487", ra: ["RA5", "RA6"], desc: "Disseny visual de sistemes mitjan莽ant diagrames.", img: "assets/m7.png", url: "modelatge-uml.html" },
            { id: 8, title: "Her猫ncia i Interf铆cies", module: "M0485", ra: ["RA7"], desc: "Relacions de classes avanzades y contractes.", img: "assets/m8.png", url: "herencia-interficies.html" },
            { id: 9, title: "Col路leccions Gen猫riques", module: "M0485", ra: ["RA6"], desc: "Gesti贸 de dades dinmiques amb Llistes y Piles.", img: "assets/m9.png", url: "colleccions-generiques.html" },
            { id: 10, title: "Persist猫ncia DAO / DTO", module: "M0485", ra: ["RA8", "RA9"], desc: "Acc茅s y gesti贸 de dades persistents en DB.", img: "assets/m10.png", url: "persistencia-dao-dto.html" },
            { id: 11, title: "Unit Testing", module: "M0487", ra: ["RA3"], desc: "Verificaci贸 automtica de la qualitat del software.", img: "assets/m11.png", url: "unit-testing.html" }
        ];

        const follower = document.getElementById('pointerFollower');
        window.addEventListener('mousemove', (e) => {
            follower.style.transform = `translate(${e.clientX + 5}px, ${e.clientY + 5}px)`;
        });

        function populateRALists() {
            ['M0485', 'M0487'].forEach(mod => {
                const list = document.getElementById(`ra-list-${mod}`);
                if (list) {
                    list.innerHTML = raData[mod].map(ra => `<div class="ra-item"><b>${ra.split('. ')[0]}.</b> ${ra.split('. ')[1]}</div>`).join('');
                }
            });
        }

        function init3DEffect() {
            document.querySelectorAll('.card-container').forEach(container => {
                const wrapper = container.querySelector('.card-wrapper');
                const overlay = container.querySelector('.mouse-overlay');
                let requestId = null;

                overlay.onmouseenter = () => { follower.style.opacity = "1"; };
                overlay.onmousemove = (e) => {
                    const rect = container.getBoundingClientRect();
                    const x = (rect.width / 2 - (e.clientX - rect.left)) / 12;
                    const y = ((e.clientY - rect.top) - rect.height / 2) / 12;
                    if (requestId) cancelAnimationFrame(requestId);
                    requestId = requestAnimationFrame(() => {
                        wrapper.style.transform = `rotateX(${y}deg) rotateY(${x}deg)`;
                    });
                };
                overlay.onmouseleave = () => {
                    follower.style.opacity = "0";
                    if (requestId) cancelAnimationFrame(requestId);
                    wrapper.style.transform = `rotateX(0deg) rotateY(0deg)`;
                };
            });
        }

        async function fetchImage(prompt) {
            const variations = ["neon pixel art", "cyberpunk asset", "retro gaming", "digital code"];
            const seed = variations[Math.floor(Math.random() * variations.length)];
            const fullPrompt = `8-bit pixel art of ${prompt}, ${seed}, dark background.`;
            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ instances: [{ prompt: fullPrompt }], parameters: { sampleCount: 1 } })
                });
                const data = await res.json();
                return data.predictions?.[0]?.bytesBase64Encoded ? `data:image/png;base64,${data.predictions[0].bytesBase64Encoded}` : null;
            } catch (e) { return null; }
        }

        function downloadImg(url, name) {
            const link = document.createElement('a');
            link.href = url;
            link.download = `${name.replace(/\s+/g, '_')}_IA.png`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

       async function loadImages() {
            for (let item of syllabus) {
                const slot = document.getElementById(`img-slot-${item.id}`);
                if (slot && item.img && !slot.querySelector('img')) {
                    await new Promise(r => setTimeout(r, 400));
                    const imgHtml = `
                        <img src="${item.img}" 
                             loading="lazy"
                             class="absolute inset-0 w-full h-full object-cover opacity-0 transition-opacity duration-1000"
                             style="filter: brightness(0.7) contrast(1.2) sepia(0.4) hue-rotate(100deg);"
                             onload="this.previousElementSibling.style.display='none'; this.classList.replace('opacity-0', 'opacity-100');">
                        <button class="download-btn z-20" onclick="event.stopPropagation(); downloadImg('${item.img}', '${item.title}')"></button>
                    `;
                    slot.innerHTML += imgHtml;
                }
            }
        }

        function setModuleFilter(mod) {
            currentModule = mod;
            const buttons = document.querySelectorAll('button[id^="mod-"]');
            
            // Reset de estilos
            buttons.forEach(btn => {
                btn.classList.remove('bg-yellow-400', 'text-black', 'border-yellow-700', 'bg-[#00d2ff]', 'bg-[#bd00ff]', 'border-blue-700', 'border-purple-700');
                btn.classList.add('bg-[#1a0133]', 'text-white', 'border-purple-900');
            });

            const activeBtn = document.getElementById(mod === 'ALL' ? 'mod-all' : `mod-${mod}`);
            
            if (activeBtn) {
                activeBtn.classList.remove('bg-[#1a0133]', 'text-white', 'border-purple-900');
                
                // ASIGNACIóN DE COLOR SEGúN CATEGORíA
                if (mod === 'ALL') activeBtn.classList.add('bg-yellow-400', 'text-black', 'border-yellow-700', 'border-b-4', 'border-r-4');
                if (mod === 'M0485') activeBtn.classList.add('bg-[#00d2ff]', 'text-black', 'border-blue-700', 'border-b-4', 'border-r-4');
                if (mod === 'M0487') activeBtn.classList.add('bg-[#bd00ff]', 'text-black', 'border-purple-700', 'border-b-4', 'border-r-4');
            }

            document.getElementById('info-M0485').style.display = (mod === 'M0485') ? 'block' : 'none';
            document.getElementById('info-M0487').style.display = (mod === 'M0487') ? 'block' : 'none';
            
            const titleText = mod === 'ALL' ? "MISSIONS_DATABASE" : (mod === 'M0485' ? "PROGRAMMING_CORE" : "ENVIRONMENT_LOGS");
            animateEncryptedText("missionsDatabaseTitle", titleText);
            renderSyllabus();
        }

        function handleSearch() { currentSearch = document.getElementById('searchInput').value.toLowerCase(); renderSyllabus(); }
        function startMission(name, desc, url) {
            if (url && url !== "#") { window.open(url, '_blank'); } 
            else {
                const m = document.getElementById('missionModal');
                document.getElementById('missionName').innerText = name;
                document.getElementById('missionDescLong').innerText = desc;
                m.style.display = 'flex';
            }
        }
        function closeMission() { document.getElementById('missionModal').style.display = 'none'; }
        function toggleProfileModal() { const m = document.getElementById('profileModal'); if (m) m.style.display = (m.style.display === 'flex') ? 'none' : 'flex'; }

        function renderSyllabus() {
            const container = document.getElementById('syllabusContainer');
            if (!container) return;
            const filtered = syllabus.filter(item => {
                const matchesMod = currentModule === 'ALL' || item.module === currentModule;
                const matchesSearch = item.title.toLowerCase().includes(currentSearch);
                return matchesMod && matchesSearch;
            });
            container.innerHTML = filtered.map(item => {
                const moduleColor = item.module === 'M0485' ? '#00d2ff' : '#bd00ff';
                return `
                <div class="card-container glitch-active" onclick="window.open('${item.url}', '_blank')">
                    <div class="mouse-overlay"></div>
                    <div class="card-wrapper" style="--card-border-color: ${moduleColor}">
                        <div class="course-card">
                            <div class="mx-1 float-layer-high">
                                <div id="img-slot-${item.id}" class="relative mt-1 aspect-video w-full rounded-[16px] overflow-hidden bg-[#050505] border-2 border-gray-800 shadow-2xl flex items-center justify-center">
                                    <div id="loader-${item.id}" class="absolute inset-0 flex flex-col items-center justify-center bg-black z-10">
                                        <div class="matrix-spinner mb-3"></div>
                                        <span class="loading-text">DOWNLOADING_ASSET...</span>
                                    </div>
                                </div>
                            </div>
                            <div class="px-2 pt-4 flex-grow float-layer-mid">
                                <div class="flex justify-between items-center mb-2 px-1">
                                    <span class="text-[6px] font-bold" style="color: ${moduleColor}">>> ${item.module}</span>
                                    <div class="flex gap-1">${item.ra.map(ra => `<span class="bg-gray-800 text-green-400 text-[5px] px-1 rounded border border-green-900/50">${ra}</span>`).join("")}</div>
                                </div>
                                <h3 class="text-[9px] font-bold text-white mb-2 uppercase tracking-tighter leading-tight glitch-target px-1">${item.title}</h3>
                                <p class="text-[7px] text-gray-500 mb-6 uppercase leading-relaxed tracking-tighter italic px-1">${item.desc}</p>
                            </div>

<div class="mt-auto w-full p-2 float-layer-low" style="position: relative; z-index: 160;">
    <div class="flex items-center justify-center gap-4 py-3 px-2 rounded-xl font-bold text-black shadow-[0_5px_0_rgba(0,0,0,0.5)] cursor-pointer transition-all active:translate-y-1 active:shadow-none hover:brightness-125" 
         style="background-color: ${moduleColor};"
         onclick="window.open('${item.url}', '_blank')"> <div class="pacman-icon"></div>
        <span class="text-[8px] tracking-tighter uppercase font-bold">OPEN MISSION</span>
    </div>
</div>
                        </div>
                    </div>
                </div>`;
            }).join('');
            init3DEffect();
            loadImages();
        }

        window.onload = () => { 
            populateRALists(); 
            animateEncryptedText("missionsDatabaseTitle", "MISSIONS_DATABASE"); 
            renderSyllabus(); 
            loadImages(); 
            const st = document.createElement('style'); 
            let bx = [];
            for(let i=0; i<450; i++) bx.push(`${Math.random()*2000}px ${Math.random()*2000}px #FFF`);
            st.innerHTML = `#stars { box-shadow: ${bx.join(', ')}; width: 1px; height: 1px; animation: animStar 140s linear infinite; }`;
            document.head.appendChild(st);
        };
		
		function downloadImg(url, name) {
            const link = document.createElement('a');
            link.href = url;
            link.download = `${name.replace(/\s+/g, '_')}_IMG.png`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>